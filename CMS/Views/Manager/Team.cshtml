<!-- Views/ManagerTeam/Index.cshtml -->
@{
    ViewData["Title"] = "My Team";
    Layout = "_ManagerLayout";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="h3">My Team</h2>
    <div>
        <button class="btn btn-success me-2" onclick="exportTeamData()">
            <i class="bi bi-download"></i> Export
        </button>
        <button class="btn btn-primary" onclick="openAddMemberModal()">
            <i class="bi bi-person-plus"></i> Add Member
        </button>
    </div>
</div>

<!-- Team Stats -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <h5 class="card-title">Total Members</h5>
                <h2>12</h2>
                <small>+2 this month</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <h5 class="card-title">Currently Online</h5>
                <h2>8</h2>
                <small>67% of team</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <h5 class="card-title">On Leave Today</h5>
                <h2>2</h2>
                <small>Planned time off</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <h5 class="card-title">Average Performance</h5>
                <h2>92%</h2>
                <small>+5% vs last month</small>
            </div>
        </div>
    </div>
</div>

<!-- Team Filters -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row">
            <div class="col-md-3">
                <input type="text" class="form-control" id="searchMember" placeholder="Search team members...">
            </div>
            <div class="col-md-2">
                <select class="form-select" id="roleFilter">
                    <option value="">All Roles</option>
                    <option value="developer">Developer</option>
                    <option value="designer">Designer</option>
                    <option value="qa">QA</option>
                </select>
            </div>
            <div class="col-md-2">
                <select class="form-select" id="statusFilter">
                    <option value="">All Status</option>
                    <option value="online">Online</option>
                    <option value="away">Away</option>
                    <option value="busy">Busy</option>
                    <option value="offline">Offline</option>
                </select>
            </div>
            <div class="col-md-2">
                <select class="form-select" id="sortBy">
                    <option value="name">Sort by Name</option>
                    <option value="performance">Sort by Performance</option>
                    <option value="tasks">Sort by Tasks</option>
                </select>
            </div>
            <div class="col-md-3 text-end">
                <button class="btn btn-outline-primary" onclick="applyFilters()">
                    <i class="bi bi-funnel"></i> Apply Filters
                </button>
                <button class="btn btn-outline-secondary" onclick="resetFilters()">
                    <i class="bi bi-arrow-counterclockwise"></i> Reset
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Team Members Grid -->
<div class="row" id="teamMembersGrid">
    <!-- Team members will be loaded here -->
</div>

<!-- Team Schedule -->
<div class="card mt-4">
    <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <h6 class="m-0 font-weight-bold">Team Schedule</h6>
        <button class="btn btn-sm btn-primary" onclick="viewSchedule()">
            <i class="bi bi-calendar"></i> View Full Schedule
        </button>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Team Member</th>
                        <th>Today's Schedule</th>
                        <th>Time Off</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="teamSchedule">
                    <!-- Schedule will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Add Member Modal -->
<div class="modal fade" id="addMemberModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Team Member</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addMemberForm">
                    <div class="mb-3">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Role</label>
                        <select class="form-select" name="role">
                            <option value="developer">Developer</option>
                            <option value="senior-developer">Senior Developer</option>
                            <option value="designer">Designer</option>
                            <option value="qa">QA Engineer</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Start Date</label>
                        <input type="date" class="form-control" name="startDate">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="addMember()">Add Member</button>
            </div>
        </div>
    </div>
</div>

<!-- Member Details Modal -->
<div class="modal fade" id="memberDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Member Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="memberDetailsContent">
                <!-- Member details will be loaded here -->
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            loadTeamMembers();
            loadTeamSchedule();
        });

        function loadTeamMembers() {
            const members = [
                { id: 1, name: 'Sarah Johnson', role: 'Senior Developer', email: 'sarah@company.com', status: 'online', performance: 95, tasks: 4, avatar: 'SJ' },
                { id: 2, name: 'Mike Chen', role: 'Developer', email: 'mike@company.com', status: 'online', performance: 88, tasks: 3, avatar: 'MC' },
                { id: 3, name: 'Emily Brown', role: 'UI Designer', email: 'emily@company.com', status: 'away', performance: 92, tasks: 2, avatar: 'EB' },
                { id: 4, name: 'David Wilson', role: 'Developer', email: 'david@company.com', status: 'online', performance: 90, tasks: 5, avatar: 'DW' },
                { id: 5, name: 'Lisa Anderson', role: 'QA Engineer', email: 'lisa@company.com', status: 'busy', performance: 94, tasks: 3, avatar: 'LA' },
                { id: 6, name: 'James Taylor', role: 'Developer', email: 'james@company.com', status: 'online', performance: 87, tasks: 4, avatar: 'JT' },
                { id: 7, name: 'Maria Garcia', role: 'Designer', email: 'maria@company.com', status: 'offline', performance: 91, tasks: 2, avatar: 'MG' },
                { id: 8, name: 'Robert Kim', role: 'Developer', email: 'robert@company.com', status: 'online', performance: 93, tasks: 4, avatar: 'RK' }
            ];

            displayMembers(members);
        }

        function displayMembers(members) {
            let html = '';
            members.forEach(member => {
                let statusClass = member.status;
                let performanceColor = member.performance >= 90 ? 'success' :
                                      member.performance >= 75 ? 'warning' : 'danger';

                html += `
                    <div class="col-md-4 col-lg-3 mb-4">
                        <div class="team-member-card card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <div class="position-relative">
                                        <div class="member-avatar">${member.avatar}</div>
                                        <span class="team-status status-${member.status} position-absolute bottom-0 end-0"></span>
                                    </div>
                                    <div>
                                        <span class="badge bg-${performanceColor}">${member.performance}%</span>
                                    </div>
                                </div>
                                <h6 class="mb-1">${member.name}</h6>
                                <p class="text-muted small mb-2">${member.role}</p>
                                <p class="text-muted small mb-2">
                                    <i class="bi bi-envelope"></i> ${member.email}
                                </p>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="badge bg-light text-dark">${member.tasks} active tasks</span>
                                    <span class="small text-${statusClass}">${member.status}</span>
                                </div>
                                <div class="btn-group w-100">
                                    <button class="btn btn-sm btn-outline-primary" onclick="viewMember(${member.id})">
                                        <i class="bi bi-eye"></i> View
                                    </button>
                                    <button class="btn btn-sm btn-outline-success" onclick="assignTaskTo('${member.name}')">
                                        <i class="bi bi-plus-circle"></i> Task
                                    </button>
                                    <button class="btn btn-sm btn-outline-info" onclick="messageMember('${member.name}')">
                                        <i class="bi bi-chat"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            $('#teamMembersGrid').html(html);
        }

        function loadTeamSchedule() {
            const schedule = [
                { member: 'Sarah Johnson', schedule: '10AM - Client Meeting, 2PM - Code Review', timeOff: 'None', avatar: 'SJ' },
                { member: 'Mike Chen', schedule: '11AM - Sprint Planning, 3PM - Development', timeOff: 'None', avatar: 'MC' },
                { member: 'Emily Brown', schedule: '9AM - Design Review, 4PM - Workshop', timeOff: 'Tomorrow (AM)', avatar: 'EB' },
                { member: 'David Wilson', schedule: '10AM - Pair Programming, 5PM - Demo Prep', timeOff: 'None', avatar: 'DW' }
            ];

            let html = '';
            schedule.forEach(item => {
                html += `
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="member-avatar me-2" style="width: 30px; height: 30px; font-size: 14px;">${item.avatar}</div>
                                ${item.member}
                            </div>
                        </td>
                        <td>${item.schedule}</td>
                        <td>${item.timeOff}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="adjustSchedule('${item.member}')">
                                <i class="bi bi-pencil"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            $('#teamSchedule').html(html);
        }

        function applyFilters() {
            const search = $('#searchMember').val().toLowerCase();
            const role = $('#roleFilter').val();
            const status = $('#statusFilter').val();
            const sort = $('#sortBy').val();

            // Filter logic would go here
            showNotification('Filters applied', 'info');
        }

        function resetFilters() {
            $('#searchMember').val('');
            $('#roleFilter').val('');
            $('#statusFilter').val('');
            $('#sortBy').val('name');
            loadTeamMembers();
        }

        function viewMember(id) {
            const member = {
                id: id,
                name: 'Sarah Johnson',
                role: 'Senior Developer',
                email: 'sarah@company.com',
                phone: '+1 234 567 890',
                joinDate: 'Jan 15, 2023',
                performance: 95,
                tasks: [
                    { title: 'UI Implementation', status: 'In Progress', due: 'Today' },
                    { title: 'Code Review', status: 'Completed', due: 'Yesterday' }
                ],
                recentActivity: [
                    'Completed task "API Integration"',
                    'Submitted weekly report',
                    'Attended sprint planning'
                ]
            };

            let html = `
                <div class="container">
                    <div class="row mb-4">
                        <div class="col-md-4 text-center">
                            <div class="member-avatar mx-auto" style="width: 100px; height: 100px; font-size: 40px;">SJ</div>
                            <h5 class="mt-3">${member.name}</h5>
                            <p class="text-muted">${member.role}</p>
                            <span class="team-status status-online"></span> Online
                        </div>
                        <div class="col-md-8">
                            <h6>Contact Information</h6>
                            <p><i class="bi bi-envelope"></i> ${member.email}</p>
                            <p><i class="bi bi-telephone"></i> ${member.phone}</p>
                            <p><i class="bi bi-calendar"></i> Joined: ${member.joinDate}</p>

                            <h6 class="mt-3">Performance</h6>
                            <div class="progress mb-3">
                                <div class="progress-bar bg-success" style="width: ${member.performance}%">${member.performance}%</div>
                            </div>
                        </div>
                    </div>

                    <h6>Current Tasks</h6>
                    <ul class="list-group mb-3">
                        ${member.tasks.map(task => `
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                ${task.title}
                                <span class="badge bg-${task.status === 'Completed' ? 'success' : 'warning'}">${task.status}</span>
                            </li>
                        `).join('')}
                    </ul>

                    <h6>Recent Activity</h6>
                    <ul class="list-group">
                        ${member.recentActivity.map(activity => `
                            <li class="list-group-item">${activity}</li>
                        `).join('')}
                    </ul>
                </div>
            `;

            $('#memberDetailsContent').html(html);
            $('#memberDetailsModal').modal('show');
        }

        function openAddMemberModal() {
            $('#addMemberForm')[0].reset();
            $('#addMemberModal').modal('show');
        }

        function addMember() {
            $('#addMemberModal').modal('hide');
            showNotification('Team member added successfully', 'success');
        }

        function exportTeamData() {
            window.location.href = '/ManagerTeam/Export';
        }

        function viewSchedule() {
            alert('Full schedule view would open here');
        }

        function adjustSchedule(member) {
            alert(`Adjust schedule for ${member}`);
        }

        function showNotification(message, type) {
            alert(message);
        }
    </script>
}